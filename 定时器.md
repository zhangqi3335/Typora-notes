# 1.定时器概述

## 1.1定时器工作原理

1. 计数模式：对引脚输人的外部脉冲信号进行计数。
2. 定时模式：对处理器内部的周期性时钟信号进行计数（时钟信号的频率是确定的，设置一个数，一个时钟信号递减1，当减少到0的时候，这个过程的时间就是定时的时间）。
3. 定时时钟：在定时模式下，输人定时器的周期性时钟信号称为定时时钟（为定时器提供的稳定时钟信号）。
4. 计数时间：在定时模式下,定时器内部的计数单元记一次数所花费的时间称为计数时间,该值为定时时钟频率的倒数。

根据定时时钟和计数时间的定义,我们可以得到定时器的定时时间计算公式:

- 定时时间=计数值x计数时间
- 定时时间=计数值/定时时钟频率

##  1.2. STM32定时器介绍

![image-20251207213328702](C:\Users\17820\AppData\Roaming\Typora\typora-user-images\image-20251207213328702.png)

常规定时器：

- 基本定时器：几乎没有任何对外的输入/输出通道，常用作时间基准(时基)，实现基本的定时功能。
- 通用定时器：具备多路独立的捕获/比较通道，可以完成**定时/计数、输入捕获、输出比较**等功能还可以连接其他的传感器接口，如编码器和霍尔传感器。
- 高级定时器：高级定时器的功能最为强大，除了具备通用定时器的功能外，还增加了重复计数器带死区控制的互补信号输出等功能，可用于电机控制等领域。
  -  ① 定时/计数功能：用于产生时间基准以及测量外部脉冲的个数。 ②输入捕获功能：用于测量输人信号的脉冲宽度。③ 输出比较功能：包括 PWM 输出、电平翻转、单脉冲输出以及强制输出等功能。 

专用定时器：

1. 看门狗定时器（Watchdog Timer）是一种**计算机硬件设备**，主要用于监测并重启系统中出现的故障，以确保系统的稳定性和可靠性。它通常作为独立芯片或集成在微控制器中，并通过定期接收**来自软件的喂狗信号**，从而防止系统出现死循环或其他致命错误。
   - 如果系统由于软件错误或者硬件故障等原因陷入死循环或者停止工作，看门狗定时器**会自动触发复位信号，重启系统**，以达到恢复系统正常运行的目的。
   - 当CPU处于假死状态时，对系统进行强制性重启；
   - 提高系统可靠性、鲁棒性和稳定性。
2. 实时时钟：就是我们所说的时间和日期；
3. 低功耗定时器：低功耗模式（如休眠）下任然工作，用于休眠中唤醒的定时器。

# 2.定时/技术功能

### 2.1 时钟源（Clock被省略）

1. HSI（High Speed Internal Clock）高速内部时钟：
  - HSI 时钟信号由**内部 8MHz 的 RC 振荡器**产生。
  - HSI 时钟可以直接作为系统时钟（SYSCLK），或者在 2 分频后作为 PLL（锁相环）的输入。
2. HSE（High Speed External Clock）高速外部时钟：
   - HSE 时钟来自**外部的无源晶振**，其频率范围通常在 **4MHz 到 16MHz 之间，但常用的是 8MHz**。HSE 时钟可以不分频或进行 2 分频（频率 / 2）后作为 PLL 的输入，也可以直接作为系统时钟（SYSCLK），或进行 128 分频后作为外设 RTC（实时时钟）的时钟输入。
3. PLL（Phase Locked Loop）锁相环时钟：
   - PLL 时钟的源可以是 **HSI/2 或 HSE**。PLL 可以对输入的时钟信号进行倍频，以产生更高频率的时钟信号，从而提高系统的性能。
4. LSE（Low Speed External Clock）和 LSI（Low Speed Internal Clock）低速时钟：
   - LSE 是一个低速的外部时钟源，通常由一个 **32.768kHz** 的低速外部晶体或陶瓷谐振器提供。它为实时时钟（RTC）或其他需要低功耗且精确时钟的定时功能提供时钟源。
   - LSI 是一个低功耗的内部时钟源，它可以在停机和待机模式下保持运行，为**独立看门狗和自动唤醒单元提供时钟**。LSI 的时钟频率大约在 30kHz 到 60kHz 之间，但通常约为 **40kHz**。

