***

# 📦 Utility Scripts Collection

本仓库包含两个日常开发中常用的小工具脚本，用于 **GitHub 仓库交互式同步** 与 **Markdown 标题自动编号**。
脚本均可独立使用，也可一起构成高效的编写文档与管理仓库的工作流。

------

## 📌 目录

- [Run.bat & Logic.ps1](#runbat--logicps1--交互式-git-同步助手)
  - 功能
  - 核心逻辑
  - 使用方法
  - 运行截图
- [sort_md.py](#sort_mdpy--markdown-标题自动编号脚本新版)
  - 功能
  - 算法逻辑
  - 使用方法
  - 示例输出

------

# Run.bat & Logic.ps1 — 交互式 Git 同步助手

### 🚀 功能

这是一套 **双文件架构** 的 Git 同步工具，专为 Windows 用户设计。
它解决了单纯 `.ps1` 脚本常见的**乱码闪退问题**，并提供了完整的交互流程（拉取、暂存、提交、推送）。
非常适合用于管理 Typora 笔记库、代码仓库等需要防止“误操作”的场景。

### ✨ 特点

- **双保险架构**：
  - `Run.bat`：负责设置 UTF-8 编码并启动环境，保证窗口不闪退。
  - `Logic.ps1`：负责核心 Git 逻辑处理，界面美观。
- **全流程交互**：
  - **拉取检查**：推送前先检测远程更新，避免冲突。
  - **灵活暂存**：支持一键 `add .`，也支持调用 `git add -i` 进行文件手动筛选。
  - **智能备注**：支持自定义 Commit 信息，不输入则自动生成时间戳。
- **防乱码设计**：完美解决 Windows CMD 中文乱码问题。

### 🧩 使用

**方式一：双击运行**
直接在文件夹中双击 **`Run.bat`** 即可启动。

**方式二：Windows 搜索（推荐）**
1. 将 `Run.bat` 创建快捷方式。
2. 将快捷方式放入 `shell:programs` 目录。
3. 按下 <kbd>Win</kbd> 键，直接搜索快捷方式名称（Typora笔记更新）并回车。

### 📘 运行流程示例

脚本运行后会弹出交互式终端：

```text
==========================================
      Typora 文档同步助手 (交互版)        
==========================================

[1/4] 检查远程仓库更新...
⚠️  发现远程有新内容！
是否拉取远程更新？ (Y/N): Y
✅ 更新文件如下：
  - 笔记/嵌入式/STM32中断.md

[2/4] 检查本地变动...
📝 检测到以下文件变动：
 M 笔记/C语言/指针.md
是否将 [所有变动] 添加到暂存区？(N=手动选择) (Y/N): Y
✅ 已添加所有文件。

[3/4] 准备提交...
请输入备注 (回车用默认: 自动备份 2026-01-02): 修正了空指针部分
✅ 提交成功！

[4/4] 准备推送...
📦 待推送的提交：
 a1b2c3d 自动备份 2026-01-02 - 修正了空指针部分
是否推送到 GitHub？ (Y/N): Y
🎉 推送成功！
```

------

# sort_md.py — Markdown 标题自动编号脚本（新版）

> ⚠ **说明**
>
> 仓库中的 `sort_md.py` 已升级为 **新版算法**，
> 旧版本中基于「`#` 首次出现顺序建层级」的实现 **已完全废弃并覆盖**。

------

## 🎯 功能

`sort_md.py` 会自动为 Markdown 文档中的标题生成 **符合 Markdown 语义的层级编号**：

```markdown
## 1 一级标题
### 1.1 二级标题
#### 1.1.1 三级标题
```

支持的标题级别：

```markdown
#  ##  ###  ####  #####  ######
```

------

## 📐 编号规则（新版）

### 1️⃣ 动态基准标题级

- 文档中 **第一个出现的标题级别** 作为逻辑一级标题
- 例如：
  - 文档从 `##` 开始 → `##` 视为 Level 1
  - 文档从 `###` 开始 → `###` 视为 Level 1

------

### 2️⃣ 标准树形编号规则

- 同级标题 → 编号递增
- 子标题 → 在父编号基础上追加 `.1`
- 回到上级 → 自动回退并递增
- 每个顶级标题（如 `##`）视为一个独立区块

------

### 3️⃣ 自动处理复杂情况

- 忽略代码块（``` 包裹内容内不会解析标题）
- 标题文本中允许包含 `# / ##`
- 自动移除原标题中的旧编号（如 `1.`、`2.3.`）
- 不修改非标题文本
- 不生成 TOC
- 保留原有缩进与 Markdown 格式

------

## 🧠 算法逻辑（简述）

1. 扫描全文，确定第一个标题的 `#` 数量作为基准层级
2. 使用固定 6 层计数器维护编号状态
3. 当前逻辑层级 = `当前 # 数 − 基准 # 数 + 1`
4. 当前层级计数 +1，所有更深层级清零
5. 仅重写标题行，其余内容保持不变

------

## ▶ 使用方法

```bash
python sort_md.py input.md
```

或指定输出文件：

```bash
python sort_md.py input.md output.md
```

默认生成：

```text
input_sorted.md
```

------

### ⚠ Windows 文件名注意事项

Windows 文件名 **不允许包含以下字符**：

```text
< > : " / \ | ? *
```

因此不要在文件名中使用 `/`，例如：

```bash
❌ python sort_md.py "C/C++关键字.md"
```

推荐做法：

1. 使用合法文件名生成文件（如 `C-C++关键字.md`）
2. 在 Markdown 内容或标题中使用 `C/C++`（内容不受限制）

------

## 📝 示例

### 原文

```markdown
# 串口通信
### 并行通信
#### 并行通信的1好
#### 并行通信的2好

### 串行通信
#### 串行通信的1好
#### 串行通信的2好
```

### 转换后

```markdown
# 1 串口通信
### 1.1 并行通信
#### 1.1.1 并行通信的1好
#### 1.1.2 并行通信的2好

### 1.2 串行通信
#### 1.2.1 串行通信的1好
#### 1.2.2 串行通信的2好
```

------

# 📄 License

本仓库中的脚本可自由使用、修改与分发。

欢迎在此基础上继续扩展更多 Markdown / 文档 / 自动化工具。

------

## ❤️ 作者

该工具集合由本人整理与开发，用于提升 Markdown 文档管理与 Git 仓库备份效率，
适合 **嵌入式学习笔记、实验报告、项目说明书、技术文档整理** 等场景。